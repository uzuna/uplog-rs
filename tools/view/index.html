<html>
    <head>
        <title>log list</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <script
            src="https://code.jquery.com/jquery-3.6.0.min.js"
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
            crossorigin="anonymous"></script>
        <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.css" />
        <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid-theme.min.css" />
            
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.js"></script>

        <script>
            var clients = [
                { "Name": "Otto Clay", "Age": 25, "Country": 1, "Address": "Ap #897-1459 Quam Avenue", "Married": false },
                { "Name": "Connor Johnston", "Age": 45, "Country": 2, "Address": "Ap #370-4647 Dis Av.", "Married": true },
                { "Name": "Lacey Hess", "Age": 29, "Country": 3, "Address": "Ap #365-8835 Integer St.", "Married": false },
                { "Name": "Timothy Henson", "Age": 56, "Country": 1, "Address": "911-5143 Luctus Ave", "Married": true },
                { "Name": "Ramona Benton", "Age": 32, "Country": 3, "Address": "Ap #614-689 Vehicula Street", "Married": false }
            ];
 
            function render_storages(data) {
                // console.log(data);
                $("#jsGrid").jsGrid({
                    width: "100%",
            
                    filtering: true,
                    inserting: false,
                    editing: false,
                    sorting: true,
                    paging: false,
            
                    data: data,
                    rowClick: function(args) { 
                        let path = '/storage/' + args.item.name;
                        console.log("row click", args, path);
                        fetch(path)
                            .then(response => response.json())
                            .then(data => render_storage(data));
                    },
            
                    fields: [
                        { name: "created_at", type: "text", width: 50},
                        { name: "name", type: "text", width: 150},
                    ]
                });
            }
            
            function render_storage(data) {
                console.log(data);
                $("#jsGrid").jsGrid({
                    width: "100%",
            
                    filtering: true,
                    inserting: false,
                    editing: false,
                    sorting: true,
                    paging: false,
            
                    data: data,
                    rowClick: function(args) { 
                        console.log("row click2", args);
                    },

            
                    fields: [
                        { name: "metadata.level", title: "level", type: "text", width: 20},
                        { name: "elapsed", title: "elapsed", type: "text", width: 40, itemTemplate: function(value, item) {
                            msec =Math.round((value.secs + value.nanos / 1000000000) * 1000000)
                            return msec / 1000000;
                        }},
                        { name: "category", type: "text", width: 80},
                        { name: "message", type: "text", width: 120},
                        { name: "kv", type: "text", width: 120, itemTemplate: function(value, item) {
                            return JSON.stringify(value);
                        }},
                    ]
                });
            }

        </script>
    </head>
    <body>
        <div id="back">back</div>
        <div id="jsGrid"></div>
        <script>
            $( "#back" ).click(function() {
                fetch('/storages')
                    .then(response => response.json())
                    .then(data => render_storages(data));
            });
            fetch('/storages')
                .then(response => response.json())
                .then(data => render_storages(data));
        </script>
    </body>
</html>